<!DOCTYPE html>
<head>
    <title>2015 Median Gross Rent by States</title>

    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-selection-multi.v1.min.js"></script>

    <!-- Introducing TopoJson -->
    <script src="https://unpkg.com/topojson@3.0.0"></script>

    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

    <link href="https://fonts.googleapis.com/css?family=Hind|Roboto" rel="stylesheet">
    <link rel="stylesheet"  type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.3.2/css/bulma.min.css">

    <style>
    .states{
        fill: #cccccc;
    }

    .state-borders {
        fill: none;
        stroke: #fff;
        stroke-width: 2px;
    }

    .selected {
        stroke: #FFFFD6;
        stroke-width: 3px;
    }
    
    svg {
        margin-left: auto;
        margin-right: auto;
        display: block;
    }

    .legend {
      font-size: 12px;
    }


    </style>
</head>

<body>
    <h1 style="text-align: center; font-size: 30px; padding-top: 30px">2015 Median Gross Rent by States</h1>
    <svg id="usMap" height = "400", width ="560"></svg>
    <p style="float: right; padding-right: 300px"><em>Source: <a href="https://factfinder.census.gov/faces/tableservices/jsf/pages/productview.xhtml?pid=ACS_15_5YR_B25031&prodType=table" style="text-decoration: none; color: #2F2F2F" target="_blank">US Census</em></a></p>

    <script>
    var margin = {top: 0, left: 50, right: 50, bottom: 0},
        height = 400 - margin.top - margin.bottom,
        width = 560 - margin.left - margin.right;

    var svg = d3.select("#usMap")
                .append("svg")
                .attr("height", height + margin.top + margin.bottom)
                .attr("width", width + margin.left + margin.right)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

   //color, based on the largest and smallest number in the dataset
    var rent_domain = [400, 500, 600, 700, 800, 900, 1000, 1100, 1200, 1300, 1400, 1500, 1600];
    var ext_rent_domain = [400, 600, 800, 1000, 1200, 1400, 1600];
    var rent_color = d3.scaleThreshold()
                    .domain(rent_domain)
                    .range(d3.schemeYlGn[9]);

    //Add legend for map
    var legend_labels = ["400", "600", "800", "1000", "1200", "1400", "1600"];

    var legend = svg.selectAll("g.legend")
        .data(ext_rent_domain)
        .enter().append("g")
        .attr("class", "legend")

    var legend_w = 20, legend_h = 20;

    legend.append("rect")
      .attr("x", -30)
      .attr("y", function(d, i){ return height - (i*legend_w) - 2*legend_h;})
      .attr("width", legend_w)
      .attr("height", legend_h)
      .style("fill", function(d, i) { return rent_color(d); })
      .style("opacity", 0.8);

  legend.append("text")
      .attr("x", -5)
      .attr("y", function(d, i){ return height - (i*legend_h) - legend_h - 4;})
      .text(function(d, i){ return legend_labels[i]; });


    //For getting numbers out of csv file
    var rentData = d3.map();

    var tooltip = d3.select("body")
            .append("div")
            .style("position", "absolute")
            .style("z-index", "10")
            .style("visibility", "hidden")
            .style("color", "#2F2F2F")
            .style("padding", "8px")
            .style("background-color", "rgba(253, 253, 253, 0.7)")
            .style("border-style", "solid")
            .style("border-width", "1px")
            .style("border-color", "#C5C5C5")
            .style("font-size", "12px")
            .style("font-family", "'Roboto', sans-serif")
            .text("tooltip");


    d3.queue()
        .defer(d3.json, "us-states.json")
        .defer(d3.csv, "grossrent.csv", function(d){
            //To parse the data in the dataset
            rentData.set(d.id, +d.rent)
        })
        .await(ready);
        

     //Everytime you use typojson, you need to write the following code
    function ready(error, us){
        if(error) throw error;

        var usStates = topojson.feature(us, {
            type:"GeometryCollection",
            geometries: us.objects.cb_2016_us_state_500k.geometries
        });

        var projection = d3.geoAlbersUsa()
            .fitExtent([ [20,20], [500,500] ], usStates);

        var path = d3.geoPath()
            .projection(projection);
        // console.log(us);

        svg.append("g")
            .attr("class", "states")
            .selectAll("path")
            .data(usStates.features)
            .enter().append("path")
            //for graphic using path, you need to include the following line every time
                .attr("d", path)
                .attr("fill", function(d){
                    return rent_color(d.rent = rentData.get(d.properties.GEOID));
                })
            // .attr("id", us.objects.states.geometries.id)
            .on("mouseover", function(d){
                d3.select(this).classed("selected", true);
                tooltip.html("<bold>" + (d.properties.NAME) + " Median Rent</bold>:<br/> $" + (d["rent"]));
                tooltip.style("visibility", "visible");
                
            })
            .on("mousemove", function(d){
                d3.select(this).classed("selected", true);
                //Must add the d3.event.pageY and PageX to activate tooltip
                return tooltip.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");
            })
            .on("mouseout", function(d){
                d3.select(this).classed("selected", false);
                tooltip.style("visibility", "hidden");
            });

        // console.log(us)

        // svg.append("path")
        //     .attr("class", "state-borders")
        //     //The filter function is called once for each candidate arc and takes two arguments, a and b, two geometry objects that share that arc.
        //     //https://github.com/topojson/topojson-client/blob/master/README.md#mesh
        //     .attr("d", path(topojson.mesh(us, us.objects.states, function (a, b){ return a !== b; })));
    };


    //Resources:
    //1. https://github.com/topojson/world-atlas
    //2. https://www.youtube.com/watch?v=aNbgrqRuoiE&t=70s
    //3. https://bl.ocks.org/mbostock/4090848
    //4. https://www.youtube.com/watch?v=suNs5p0IxWk
    //5. http://bl.ocks.org/KoGor/5685876 (legend)

    // Source:
    // 1. https://factfinder.census.gov/faces/tableservices/jsf/pages/productview.xhtml?pid=ACS_15_5YR_B25031&prodType=table

    </script>


</body>
</html>