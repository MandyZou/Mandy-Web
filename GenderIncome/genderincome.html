<!DOCTYPE html>
<meta charset="utf-8">
<head>
    <title>Education v. Income: Gender Gap</title>

    <script src="http://d3js.org/d3.v4.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">

    <link href="https://fonts.googleapis.com/css?family=Zilla+Slab" rel="stylesheet">

<style>
    body{
        font-family: 'Zilla Slab', serif;
    }

    h1{
        margin:0;
        padding-left: 30px;
        padding-top: 10px;
    }

    p{
        margin:0;
        padding-left: 30px;
        padding-top: 10px;
    }

    .xaxis .domain{
        display: none;
    }

    .xaxis line{
        stroke: #e0e0e0;
    }

    .xaxis text{
        font-size: 13px;
    }

    .yaxis .domain{
        display: none;
    }

    .yaxis line{
        stroke: #e0e0e0;
        stroke-width: 0.5px;
    }

    #chart {
        width: 520px;
        height: 600px;
        /*margin-left: 30px;*/
        /*float: left;*/
        margin: 0 auto;
    }

    .overlay {
      fill: none;
      pointer-events: all;
    }

    .buttons{
       margin-left: 30px;
    }

    button{
        margin-top: 20px;
        background-color: #FFF;
        border: 2px solid rgb(235,235,235);
        border-radius: 8px;
        font-size: 15px;
        padding: 10px 20px;
        -webkit-transition-duration: 0.4s;
        transition-duration: 0.4s;
        cursor: pointer;
    }

     button:hover {
        background-color: rgb(235,235,235);
    }

    button:focus {
        outline: 0;
        background-color: rgb(235,235,235);
    }




</style>

</head>

<body onload="document.getElementById('Less Highschool').focus()">
    <h1>How Gender Pay Gap Vary in Education Degrees</h1>
    <p>In general, a higher degree triggers a bigger pay gap between male and female. Plus, the gap doesn't change much over the past 6 years.</p>
    <div class="buttons">
        <button id="Less Highschool">Less than High School Graduate</button>
        <button id="Highschool">High School Graduate</button>
        <button id="Associate">Associate</button>
        <button id="Bachelor">Bachelor</button>
        <button id="Graduate">Graduate</button>
        <button id="All">All</button>
    </div>
    <div id="chart"></div>
    <script>
    //Timeline: https://pudding.cool/2017/03/incarceration/

        var margin = {top: 100, left: 40, right: 40, bottom: 30},
            width = 500 - margin.left - margin.right,
            height = 400 - margin.top - margin.bottom;

        var svg = d3.select("#chart")
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform","translate(" + margin.left + "," + margin.top + ")"); 

        var x = d3.scaleLinear()
                  .domain([2010,2015])
                  .range([0,width]);

        var y = d3.scaleLinear()
                  .domain([14000,85000])
                  .range([height,0]);

        var z = d3.scaleOrdinal(d3.schemeCategory10)
                .domain(["Male","Female"])
                .range(["#17927C","#F4B7DF"]);

        var line = d3.line()
                        .x(function(d){return x(d.Year); })
                        .y(function(d){return y(d.Income); });

        //add axis
        svg.append("g")
                .attr("class","xaxis")
                .attr("transform","translate(0," + height + ")")
                .call(d3.axisBottom(x)
                        .ticks(6)
                        .tickPadding([10])
                        .tickFormat(d3.format(" "))
                        .tickSizeOuter(0));

        svg.append("g")
                .attr("class","yaxis")
                .attr("transform","translate(" + width + ",0)")
                .call(d3.axisLeft(y)
                        .tickFormat(d3.format(",d"))
                        .tickSize(width)
                        .tickSizeOuter(0)
                        .tickPadding([6]))
                .append("text")
                .attr("dy","1em")
                .attr("transform","translate(-341,0)")
                .style("fill","#000")
                .text("Median Income($)");

        svg.append("text")
                .attr("x", 120)
                .attr("y", 0)
                .attr("class","title")
                .text("Less Highschool Degree");

            //Add legend
            svg.append("line")
                .attr("x1", 0)
                .attr("x2", 30)
                .attr("y1", -40)
                .attr("y2", -40)
                .attr("class","lines")
                .style("stroke","#17927C")
                .style("stroke-width","4px");

            svg.append("text")
                .attr("x",35)
                .attr("y", -35)
                .style("font-size","15px")
                .text("Male");

            svg.append("line")
                .attr("x1", 80)
                .attr("x2", 110)
                .attr("y1", -40)
                .attr("y2", -40)
                .attr("class","lines")
                .style("stroke","#F4B7DF")
                .style("stroke-width","4px");

            svg.append("text")
                .attr("x",115)
                .attr("y", -35)
                .style("font-size","15px")
                .text("Female");

        d3.queue()
          .defer(d3.csv,"combine.csv")
          .await(ready);

        function ready(error, data0){
            if(error) throw error;

            var highschool = data0.filter(function(d){return d.Degree == "Less Highschool"; });

            var genders = d3.keys(highschool[0]).slice(1,3).map(function(id){
                return {
                    id:id,
                    values:highschool.map(function(d){
                        return {Year: d.Year, Income: d[id]};
                    })
                };
            });

            // console.log(genders)

            var chart = svg.selectAll(".gender")
                        .data(genders)
                        .enter().append("g")
                            .attr("class","gender");

            var path = chart.append("path")
                .attr("class","income")
                .attr("d", function(d){return line(d.values); })
                .style("stroke", function(d){return z(d.id); })
                .transition()
                    .duration(1000)
                    .ease(d3.easeSin)
                .style("stroke-width",4)
                .attr("fill","none");

            //Fill area
            var area = d3.area()
                        .x0(function(d){return x(d.Year); })
                        .x1(function(d){return x(d.Year); })
                        .y0(function(d){return y(d.Male); })
                        .y1(function(d){return y(d.Female); });

            svg.append("path")
                .datum(data0.filter(function(d){return d.Degree == "Less Highschool"; }))
                .attr("class","area")
                .attr("d", area)
                .style("fill","rgb(235,235,235)");

              //add focus for lines
            var focus = svg.append("g")
                        .attr("class","focus")
                        .style("display","none");

            focus.append("circle")
                 .attr("r","3");

            focus.append("text")
                 .attr("class","focusText")
                 .attr("x",-23)
                 .attr("dy","-0.7em");

            var focus2 = svg.append("g")
                        .attr("class","focus")
                        .style("display","none");

            focus2.append("circle")
                 .attr("r","3");

            focus2.append("text")
                 .attr("class","focusText")
                 .attr("x",-23)
                 .attr("dy","-0.7em");

            svg.append("rect")
                .attr("class", "overlay")
                .attr("width", width)
                .attr("height", height)
                .on("mouseover", function(){
                    focus.style("display", null); 
                    focus2.style("display", null);})
                .on("mouseout", function(){
                    focus.style("display", "none"); 
                    focus2.style("display", "none"); })
                .on("mousemove", mousemove);

            var bisectDate = d3.bisector(function(d) { return d.Year; }).left;

            var numberFormat = d3.format(",d");

            var currentData = data0.filter(function(d){return d.Degree == "Less Highschool"; });

            function mousemove() {
              var x0 = x.invert(d3.mouse(this)[0]),
                  i = bisectDate(currentData, x0, 1),
                  d0 = currentData[i - 1],
                  d1 = currentData[i],
                  d = x0 - d0.Year > d1.Year - x0 ? d1 : d0;
              focus.attr("transform", "translate(" + x(d.Year) + "," + y(d.Male) + ")");
              focus.select("text").html(function() { return "$" + numberFormat(d.Male); });
              focus.select("text.female").html(function() { return "$" + d.Male; });
              focus2.attr("transform", "translate(" + x(d.Year) + "," + y(d.Female) + ")");
              focus2.select("text").html(function() { return "$" + numberFormat(d.Female); });
              focus2.select("text.female").html(function() { return "$" + d.Female; });
            }; //end of mousemove function


            //add button function
            d3.selectAll("button")
                .on("click", function(){
                    draw(this.id);
                });

            function draw(Degree){
                var newData = data0.filter(function(d){return d.Degree == Degree; });

                // console.log(newData);

                var genders2 = d3.keys(newData[0]).slice(1,3).map(function(id){
                    return {
                        id:id,
                        values: newData.map(function(d){
                            return {Year: d.Year, Income: d[id]};
                        })
                    };
                });

                // console.log(genders2);

                d3.selectAll(".income").remove();
                d3.select(".area").remove();

                var newLine = svg.selectAll(".gender")
                        .append("path");

                newLine.data(genders2)
                    .attr("d", function(d){return line(d.values); })
                    .attr("class","income")
                    .style("stroke", function(d){return z(d.id); })
                    .transition()
                        .duration(1000)
                        .ease(d3.easeLinear)
                    .style("stroke-width",4)
                    .attr("fill","none");


                //Fill area
                svg.append("path")
                    .datum(data0.filter(function(d){return d.Degree == Degree; }))
                    .attr("class","area")
                    .attr("d", area)
                    .style("fill","rgb(235,235,235)");

            //add focus for lines
            var focus = svg.append("g")
                        .attr("class","focus")
                        .style("display","none");

            focus.append("circle")
                 .attr("r","3");

            focus.append("text")
                 .attr("class","focusText")
                 .attr("x",-23)
                 .attr("dy","-0.7em");

            var focus2 = svg.append("g")
                        .attr("class","focus")
                        .style("display","none");

            focus2.append("circle")
                 .attr("r","3");

            focus2.append("text")
                 .attr("class","focusText")
                 .attr("x",-23)
                 .attr("dy","-0.7em");

            svg.append("rect")
                .attr("class", "overlay")
                .attr("width", width)
                .attr("height", height)
                .on("mouseover", function(){
                    focus.style("display", null); 
                    focus2.style("display", null);})
                .on("mouseout", function(){
                    focus.style("display", "none"); 
                    focus2.style("display", "none"); })
                .on("mousemove", mousemove);

            var bisectDate = d3.bisector(function(d) { return d.Year; }).left;

            var numberFormat = d3.format(",d");

            var currentData = data0.filter(function(d){return d.Degree == Degree; });

            function mousemove() {
              var x0 = x.invert(d3.mouse(this)[0]),
                  i = bisectDate(currentData, x0, 1),
                  d0 = currentData[i - 1],
                  d1 = currentData[i],
                  d = x0 - d0.Year > d1.Year - x0 ? d1 : d0;
              focus.attr("transform", "translate(" + x(d.Year) + "," + y(d.Male) + ")");
              focus.select("text").html(function() { return "$" + numberFormat(d.Male); });
              focus.select("text.female").html(function() { return "$" + d.Male; });
              focus2.attr("transform", "translate(" + x(d.Year) + "," + y(d.Female) + ")");
              focus2.select("text").html(function() { return "$" + numberFormat(d.Female); });
              focus2.select("text.female").html(function() { return "$" + d.Female; });
            }; //end of mousemove function

            d3.select(".title")
                .text(Degree + " Degree");


                // lines.exit()
                //     .transition()
                //     .duration(1000)
                //     .attr("d", null)
                //     .remove();

                // lines.enter()
                //     .append("path")
                //     .attr("class","line")
                //     .attr("d", function(d){return line(d.values); })
                //     .merge(lines).transition()
                //     .duration(1000)
                //     // .ease("linear")
                //     .attr("fill","none");
                //     // .style("stroke","#000");

            }; //end of draw


            }; //end of data function



//Resources: https://stackoverflow.com/questions/39431032/using-d3-filter-in-an-update-function


    </script>

</body>
</html>