<!DOCTYPE html>

<head>
    <title>The Ranking of Coffee House for Freenlancersâ˜•</title>

    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="jquery-3.2.1.min.js"></script>

     <!-- Introducing TopoJson -->
    <script src="https://unpkg.com/topojson@3.0.0"></script>

    <link href="https://fonts.googleapis.com/css?family=Pangolin" rel="stylesheet">

    <style>
    body {
        font-family: 'Pangolin', cursive;
    }

    #DCmap {
        display: block;
        margin: auto;
    }

    .pinCircle{
        fill: rgba(67, 48, 3, .5);
        stroke-width: 2px;
    }


    </style>
</head>

<body>
    <h1 style="text-align: center">Best DC Coffee Shops for Freelancers</h1>
    <svg id="DCmap" width="500" height="500"></svg>

    <script>
    var margin = {top: 20, left: 20, right: 20, bottom: 20},
        width = 500 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

    var projection = d3.geoAlbers()
        .scale(1)
        .translate([0, 0]);

    var path = d3.geoPath()
            .projection(projection);

    var svg = d3.select("#DCmap")
                .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                .append("g")
                    .attr("transform", "translate(" + margin.top + "," + margin.left + ")");

    var tooltip = d3.select("body")
                    .append("div")
                    .style("position", "absolute")
                    .style("z-index", "10")
                    .style("visibility", "hidden")
                    .style("color", "#2F2F2F")
                    .style("padding", "8px")
                    .style("background-color", "rgb(253, 253, 253)")
                    .style("border-style", "solid")
                    .style("border-width", "1px")
                    .style("border-color", "#C5C5C5")
                    .style("font-size", "12px")
                    .style("font-family", "'Roboto', sans-serif")
                    .text("tooltip");

    d3.queue()
        .defer(d3.json, "dcneighborhood.json")
        .defer(d3.csv, "list.csv")
        .await(ready);

    function ready(error, data, coffee){
        if (error) throw error;

        // var neighborhood = topojson.feature(data, {
        //     type: "FeatureCollection",
        //     feature: data.features.geometry
        // });

        // var neighborhood = topojson.feature(data, {
        //     type : "FeatureCollection",
        //     // features: features,
        // });
        // var usStates = topojson.feature(us, {
        //     type:"GeometryCollection",
        //     geometries: us.objects.cb_2016_us_state_500k.geometries
        // });

        //*Important step to automatically center the map (https://stackoverflow.com/questions/14492284/center-a-map-in-d3-given-a-geojson-object)
        var b = path.bounds(data),
            s = .95 / Math.max((b[1][0] - b[0][0]) / width, (b[1][1] - b[0][1]) / height),
            t = [(width - s * (b[1][0] + b[0][0])) / 2, (height - s * (b[1][1] + b[0][1])) / 2];

            projection
            .scale(s)
            .translate(t);

        // c1 = {name: "starbucks", lat: 38.799111, long: -77.035068};
        // c2 = {lat: 38.909199, long: -77.047579};
        // bb = [38.907796, -77.044146];

        svg.selectAll("path")
            .data(data.features)
            .enter().append("path")
                .attr("class", "neighborhoods")
                .attr("d", path)
                .attr("fill", "#FFE5D4")
                .attr("stroke", "white");

        svg.selectAll("circle")
            .data(coffee).enter()
            .append("circle")
            .attr("class", "pinCircle")
            .attr("r", "5px")
            .attr("fill", "red")
            .attr("transform", function(d) {return "translate(" + projection([d.long,d.lat]) + ")";})
            .on("mouseover", function(d){
                d3.select(this).style("fill", "rgb(67, 48, 3)");
                tooltip.html("<bold>" + d.Name + ":</bold> <br/>" + d.Address);
                tooltip.style("visibility", "visible");
                tooltip.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");
            })
            .on("mouseout", function(d){
                d3.select(this).style("fill", "rgba(67, 48, 3, .5)");
                tooltip.style("visibility", "hidden");
            });
    };

    </script>

</body>
</html>