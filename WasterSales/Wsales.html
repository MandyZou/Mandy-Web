<!DOCTYPE html>
<head>
    <title>Waster Sales Number</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>

    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

    <style>
    #map {
        display: block;
        margin: 0 auto;
    }


    </style>

</head>

<body>
    <svg id="map" width = "960" height = "500"></svg>

    <script>
    var margin = {top: 20, left: 20, right: 20, bottom: 20},
        width = 960 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

    var projection = d3.geoMercator()
                   .scale(130)
                  .translate( [width / 2, height / 1.5]);

    var path = d3.geoPath()
        .projection(projection);

    var headphone_domain = [0,1000,2000,3000,5000,10000,15000,100000];

    var headphone_color = d3.scaleThreshold()
                            .domain(headphone_domain)
                            .range(["rgb(250,252,255)", "rgb(238,245,250)", "rgb(198,219,239)", "rgb(158,202,225)", "rgb(107,174,214)", "rgb(66,146,198)","rgb(33,113,181)","rgb(8,81,156)","rgb(8,48,107)","rgb(3,19,43)"]);

    var svg = d3.select("#map")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.top + "," + margin.left + ")");

    var tooltip = d3.select("body")
                    .append("div")
                    .style("position", "absolute")
                    .style("z-index", "10")
                    .style("visibility", "hidden")
                    .style("color", "#2F2F2F")
                    .style("padding", "8px")
                    .style("background-color", "rgba(253, 253, 253, 0.7)")
                    .style("border-style", "solid")
                    .style("border-width", "1px")
                    .style("border-color", "#C5C5C5")
                    .style("font-size", "12px")
                    .style("font-family", "'Roboto', sans-serif")
                    .text("tooltip");


    var headphoneData = d3.map();

    d3.queue()
      .defer(d3.json, "world.json")
      .defer(d3.csv, "WsalesHeadphone2.csv", function(d){
        headphoneData.set(d.Name, +d.Headphone)
      })
      .await(ready);

    function ready(error, mData, sData){
        if (error) throw error;

        //Set else if statement for tooltip
        function showhidefunc(d){
            if(d["Headphone"] !== 0) {
                tooltip.html("<strong>" + (d.properties.name) + " Headphone Sales Volume</strong>:<br/> <span style='color: red'>$" + d3.format(",d")(d["Headphone"])) + "</span>";
                tooltip.style("visibility", "visible");
                tooltip.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");
            } else {
                tooltip.style("visibility","hidden");
            }
        };

        svg.selectAll("path")
            .data(mData.features)
            .enter().append("path")
            .attr("class", "countries")
            // .attr("fill", "#c2c2c2")
            .attr("stroke", "#fff")
            .attr("stroke-linejoin", "round")
                .attr("d", path)
                .attr("fill", function(d){
                    return headphone_color(d.Headphone = headphoneData.get(d.properties.name));
                })
            .on("mouseover", function(d){
                showhidefunc(d);
                $(".countries").attr("fill","red");
            })
            .on("mouseout", function(d){
                tooltip.style("visibility","hidden");
            });
    };

//Resources:
//http://bl.ocks.org/micahstubbs/8e15870eb432a21f0bc4d3d527b2d14f


// Data source: http://www.naturalearthdata.com/downloads/110m-cultural-vectors/
    </script>


</body>
</html>