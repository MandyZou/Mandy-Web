<!DOCTYPE html>
<head>
    <title>Waster Sales Number</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>

    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="jquery-3.2.1.min.js"></script>

    <style>
    #earMap {
        display: block;
        margin: 0 auto;
    }

    .earphone_selected{
        fill: #989BF2
    }

    </style>

</head>

<body>
    <svg id="earMap" width = "960" height = "500"></svg>

    <script>
    var margin = {top: 20, left: 20, right: 20, bottom: 20},
        width = 960 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

    var projection = d3.geoMercator()
                    .scale(130)
                    .translate( [width / 2, height / 1.5]);

    var path = d3.geoPath()
        .projection(projection);

    var earphone_domain = [0,9000, 10000, 20000, 30000, 40000, 50000, 60000, 70000, 80000, 90000, 110000, 120000];

    var earphone_color = d3.scaleThreshold()
                            .domain(earphone_domain)
                            .range(["#f2f0f7", "#EAEAF3", "#bcbddc", "#9e9ac8", "#756bb1", "#54278f"]);

    var earphone_svg = d3.select("#earMap")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.top + "," + margin.left + ")");

    var tooltip = d3.select("body")
                    .append("div")
                    .style("position", "absolute")
                    .style("z-index", "10")
                    .style("visibility", "hidden")
                    .style("color", "#2F2F2F")
                    .style("padding", "8px")
                    .style("background-color", "rgba(253, 253, 253, 0.7)")
                    .style("border-style", "solid")
                    .style("border-width", "1px")
                    .style("border-color", "#C5C5C5")
                    .style("font-size", "12px")
                    .style("font-family", "'Roboto', sans-serif")
                    .text("tooltip");


    var earphoneData = d3.map();

    d3.queue()
      .defer(d3.json, "world.json")
      .defer(d3.csv, "WsalesEarphone.csv", function(d){
        earphoneData.set(d.Name, +d.earphone)
      })
      .await(ready);

    function ready(error, mData, eData){
        if (error) throw error;

        // console.log(earphoneData)

        function showhideearphone(d){
            if(d["earphone"] !== 0){
                tooltip.html("<strong>" + (d.properties.name) + "Earphone Sales Volume:</strong> <br/><span style='color: red'>$" + d3.format(",d")(d["earphone"]) + "</span>");
                tooltip.style("visibility", "visible");
                tooltip.style("top", (d3.event.pageY - 10)+ "px").style("left", (d3.event.pageX + 10) + "px");
            } else {
                tooltip.style("visibility", "hidden");
            }
        };


        earphone_svg.selectAll("path")
            .data(mData.features)
            .enter().append("path")
            .attr("class", function(d){return d.properties.name})
            .attr("d", path)
                .attr("stroke", "#fff")
                .attr("stroke-linejoin", "round")
                .attr("fill", function(d){
                    return earphone_color(d.earphone = earphoneData.get(d.properties.name));
                })
            .on("mouseover", function(d){
                showhideearphone(d);
                d3.select(this).classed("earphone_selected", true);
            })
            .on("mouseout", function(d){
                tooltip.style("visibility", "hidden");
                d3.select(this).classed("earphone_selected", false);
            });
    };



    </script>

</body>
</html>