<!DOCTYPE html>
<head>
    <title>Waster Sales Number</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://unpkg.com/topojson-client@3"></script>

    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="jquery-3.2.1.min.js"></script>

    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

    <style>
    #napMap {
        display: block;
        margin: 0 auto;
    }
    .nap_selected{
        fill: #FF8282;
    }


    </style>

</head>

<body>
    <svg id="napMap" width = "960" height = "500"></svg>

    <script>
    var margin = {top: 20, left: 20, right: 20, bottom: 20},
        width = 960 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;

    var projection = d3.geoMercator()
                   .scale(130)
                  .translate( [width / 2, height / 1.5]);

    var path = d3.geoPath()
        .projection(projection);

    var nap_domain = [0,5000,6000,80000,90000,100000,130000,100000,200000,300000];

    var nap_color = d3.scaleThreshold()
                            .domain(nap_domain)
                            .range(d3.schemeReds[9]);

    var nap_svg = d3.select("#napMap")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.top + "," + margin.left + ")");

    var tooltip = d3.select("body")
                    .append("div")
                    .style("position", "absolute")
                    .style("z-index", "10")
                    .style("visibility", "hidden")
                    .style("color", "#2F2F2F")
                    .style("padding", "8px")
                    .style("background-color", "rgba(253, 253, 253, 0.7)")
                    .style("border-style", "solid")
                    .style("border-width", "1px")
                    .style("border-color", "#C5C5C5")
                    .style("font-size", "12px")
                    .style("font-family", "'Roboto', sans-serif")
                    .text("tooltip");


    var napData = d3.map();

    d3.queue()
      .defer(d3.json, "world.json")
      .defer(d3.csv, "WsalesNap.csv", function(d){
        napData.set(d.Name, +d.Nap_Zappers)
      })
      .await(ready);

    function ready(error, mData, sData){
        if (error) throw error;

        //Set else if statement for tooltip
        function showhidefunc(d){
            if(d["Nap_Zappers"] !== 0) {
                tooltip.html("<strong>" + (d.properties.name) + " Nap Zappers Sales Volume</strong>:<br/> <span style='color: red'>$" + d3.format(",d")(d["Nap_Zappers"]) + "</span>");
                tooltip.style("visibility", "visible");
                tooltip.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");
            } else {
                tooltip.style("visibility","hidden");
            }
        };

        nap_svg.selectAll("path")
            .data(mData.features)
            .enter().append("path")
            .attr("class", function(d){return d.properties.name})
            // .attr("fill", "#c2c2c2")
            .attr("stroke", "#fff")
            .attr("stroke-linejoin", "round")
                .attr("d", path)
                .attr("fill", function(d){
                    return nap_color(d.Nap_Zappers = napData.get(d.properties.name));
                })
            .on("mouseover", function(d){
                showhidefunc(d);
                 d3.select(this).classed("nap_selected", true);
            })
            .on("mouseout", function(d){
                tooltip.style("visibility", "hidden");
                d3.select(this).classed("nap_selected", false);
            });

    };

//Resources:
//http://bl.ocks.org/micahstubbs/8e15870eb432a21f0bc4d3d527b2d14f
//https://bl.ocks.org/fil/0bf58d23011ab244c657a1262bcbe4b2


// Data source: http://www.naturalearthdata.com/downloads/110m-cultural-vectors/
    </script>


</body>
</html>