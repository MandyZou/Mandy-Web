<!DOCTYPE html>
<head>
    <title>Median Gross Bedroom Rent by State</title>

    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-selection-multi.v1.min.js"></script>

    <!-- Introducing TopoJson -->
    <script src="https://unpkg.com/topojson@3.0.0"></script>

    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

    <script type="text/javascript" src="sorttable.js"></script>

    <link rel="stylesheet"  type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.3.2/css/bulma.min.css">

    <link href="https://fonts.googleapis.com/css?family=Hind|Roboto" rel="stylesheet">

    <script type="text/javascript" src="tabulate.js"></script>


    <style>
    #table {
        margin: auto;
        width: 50%;
        padding: 10px;
    }
    
    svg {
        margin-left: auto;
        margin-right: auto;
        display: block;
    }
    .line {
      fill: none;
      stroke: #CCCCCC;
      stroke-width: 2px;
    }

    .listSelected {
      stroke: #09C909;
      fill: none;
      stroke-width: 3px;
    }

    .selected {
        stroke: #09C909;
    }

    #States{
      margin-left: 45%;
      margin-top: 20px;
    }

    #State\ Average{
      stroke: #FF6666;
    }

    #table{
      font-size: 15px;
      margin: 0 auto; 
      padding-top: 50px;
      padding-left: 100px;
    }

    td {
      padding-top: 5px;
      padding-bottom: 5px;
    }

    [class*="-"]{
      color: red;
      padding-left: 60px;
      font-weight: bold;
    }

    table.sortable th:not(.sorttable_sorted):not(.sorttable_sorted_reverse):not(.sorttable_nosort):after { 
    content: " \25B4\25BE" 
    }

    table.sortable th{
      cursor: pointer;
    }

    </style>
</head>

<body>
    <h1 style="text-align: center; padding-top: 50px; font-size: 20px">Median Bedroom Gross Rent by States from 2010 to 2015</h1>
  <div id="rent-blurb-default" style="text-align: center; font-size: 11px">The highest median rent is in Hawaii ($1438 in 2015) and the lowest rent is in Puerto Rico ($456 in 2015).</div>
  <!-- Blurb -->
  <div id="rent-blurb" style="text-align: center; font-size: 11px"></div> 

  <!-- Dropdown Menu -->
  <select id="States">
    <option>State Average</option>
  </select>

  <script>
  var statesList = {"1":"Alabama","2":"Alaska","3":"Arizona","4":"Arkansas","5":"California","6":"Colorado","7":"Connecticut","8":"Delaware","9":"District of Columbia","10":"Florida","11":"Georgia","12":"Hawaii","13":"Idaho","14":"Illinois","15":"Indiana","16":"Iowa","17":"Kansas","18":"Kentucky","19":"Louisiana","20":"Maine","21":"Maryland","22":"Massachusetts","23":"Michigan","24":"Minnesota","25":"Mississippi","26":"Missouri","27":"Montana","28":"Nebraska","29":"Nevada","30":"New Hampshire","31":"New Jersey","32":"New Mexico","33":"New York","34":"North Carolina","35":"North Dakota","36":"Ohio","37":"Oklahoma","38":"Oregon","39":"Pennsylvania","40":"Rhode Island","41":"South Carolina","42":"South Dakota","43":"Tennessee","44":"Texas","45":"Utah","46":"Vermont","47":"Virginia","48":"Washington","49":"West Virginia","50":"Wisconsin","51":"Wyoming","52":"Puerto Rico"};

//Add options
  $.each(statesList, function(key, value){
    $("#States")
      .append($("<option>", {key, value})
      .text(value));
  });

  // function displayVals() {
  //   var singleValues = $( "#States" ).val();
  //   // console.log("'[id=" + "'" + singleValues + "'" + "]'"); 
  //   //Deal with id name with a space
  //   $("'[id=" + "'" + singleValues + "'" + "]'").addClass("listSelected")
  // };
   
  // $("select").change(displayVals);
  // displayVals();

  $("#States").on("change", function(){
    var singleValue = $(this).val();
    //Id name with space in 
    $('.listSelected').attr("class", "line");
    $("[id='" + singleValue + "']").attr("class","listSelected")
    // console.log("[id='" + singleValue + "']")
  });

  </script>

  <!-- Line Chart -->
  <svg id="rentLine" width = "900" height = "500"></svg>

    <script>
  var margin = {top: 20, bottom: 20, left: 50, right: 20},
      height = 500 - margin.top - margin.bottom,
      width = 900 - margin.left - margin.right;

  var states = ["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","District of Columbia","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming","Puerto Rico", "State Average"];

  var state = {};

  var years = [2015,2014,2013,2012,2011,2010];

  var x = d3.scaleLinear().range([0, width]),
      y = d3.scaleLinear().range([height, 0]);

  //Set up svg
  var svg = d3.select("#rentLine")
          .append("svg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
          .append("g")
              .attr("transform", "translate(" + margin.left + "," + margin.top +")");

  var tooltip = d3.select("body")
            .append("div")
            .style("position", "absolute")
            .style("z-index", "10")
            .style("visibility", "hidden")
            .style("color", "#2F2F2F")
            .style("padding", "8px")
            .style("background-color", "rgba(253, 253, 253, 0.7)")
            .style("border-style", "solid")
            .style("border-width", "1px")
            .style("border-color", "#C5C5C5")
            .style("font-size", "12px")
            .style("font-family", "'Roboto', sans-serif")
            .text("tooltip");

  d3.queue()
    .defer(d3.text, "grossrent4.csv")
    .await(ready);

  function ready(error, data){
    if (error) throw error;

    var text = d3.csvParseRows(data);
    // console.log(text)

    for(i=1;i<states.length;i++){
        //Slice all the y numbers out
        var values=text[i+1].slice(1,text[i.length]);
        // console.log(values);

        var currData =[];state[states[i]] = states[i];
        //*Important* step to puy each year and each value together
        for(j=0;j<values.length;j++){
          currData.push({x: years[j], y: values[j], z: states[i]});
          };
          // console.log(currData);
          // console.log(currData[i]["y"])

        var line = d3.line().x(function(d,i){return x(d.x);}).y(function(d){return y(d.y);});

        x.domain([2010, 2015]);
        y.domain([400, 1500]);

        // var valueList = [];
        var valueLongList = [];

        svg.append("path")
            .data([currData])
            .attr("id", states[i])
            .attr("class", "line")
            .attr("d", line)
            .on("mouseover", function(d){
                d3.select(this).classed("selected", true);
                for (n=0; n<years.length; n++) {
                  valueLongList.push(d[Object.keys(d)[n]].y);
                }
                var valueList = valueLongList.slice(-6);
                // console.log(valueList);
                var valueMax = Math.max.apply(Math, valueList);
                // console.log(valueMax);
                var valueMin = Math.min.apply(Math, valueList);
                // console.log(valueMin);
                // console.log(d[Object.keys(d)[3]].z) OMG it is happening!!! Crying Out Loud!
                tooltip.html(d[Object.keys(d)[3]].z);
                // console.log(d)
                tooltip.style("visibility", "visible");
                tooltip.style("top", (d3.event.pageY-10)+"px").style("left",(d3.event.pageX+10)+"px");
                $("#" + d[Object.keys(d)[3]].z + "-2").attr("style", "fill: #FF6666");
                var blurb = d[Object.keys(d)[3]].z + "'s highest rent is $" + valueMax + ", its lowest rent is $" + valueMin
                $("#rent-blurb-default").hide();
                $("#rent-blurb").html(blurb);
            })
            .on("mouseout", function(d){
                d3.select(this).classed("selected", false);
                tooltip.style("visibility", "hidden");
                $("#" + d[Object.keys(d)[3]].z + "-2").removeAttr("style", "fill: #FF6666");
                $("#rent-blurb-default").show();
                $("#rent-blurb").html('');
            })
            .on("click", function(d){
              $("#" + d[Object.keys(d)[3]].z + "-2").attr("style", "fill: #FF6666");
              // console.log("#" + d[Object.keys(d)[3]].z + "-2");
            });

        var dollarFormat = function(d){ return "$" +  d3.format(",d")(d);};

        svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x)
                .ticks(5)
                .tickFormat(d3.format("")));

        svg.append("g")
            .call(d3.axisLeft(y)
              .tickFormat(dollarFormat));

        svg.append("text")
          .attr("dx", 770)
          .attr("dy", 270)
          .style("font-size", "10px")
          .text("State Average");
      }};

    </script>

  <div id="table"></div>
  <script type="text/javascript">
    //Load in contents of CSV file, and do things to the data.
    d3.csv("grossrent.csv", function(error, myData) {
        if (error) throw error;
        // We'll be using simpler data as values, not objects.
        var myArray = [];

        myData.forEach(function(d, i){
            // now we add another data object value, a calculated value.
            // here we are making strings into numbers using type coercion
            d.Rent = +d.Rent;
            d.IncreaseRate = d3.format("+,.0%")(+d.IncreaseRate);
            // Add a new array with the values of each:
            myArray.push([d.State, d.Rent, d.IncreaseRate]);
        });

        // Using RBG
        var colors = [{
                      r: 255,
                      g: 0,
                      b: 0
                  }, {
                      r: 0,
                      g: 255,
                      b: 0
                  }, {
                      r: 0,
                      g: 0,
                      b: 255
                  }, {
                      r: 255,
                      g: 255,
                      b: 0
                  }, {
                      r: 255,
                      g: 140,
                      b: 0
                  }, {
                      r: 230,
                      g: 230,
                      b: 250
                  }, {
                      r: 25,
                      g: 25,
                      b: 25
                  }, {
                      r: 165,
                      g: 42,
                      b: 42
                  }, {
                      r: 127,
                      g: 0,
                      b: 255
                  }, {
                      r: 0,
                      g: 255,
                      b: 255
                  }];

        var alpha = d3.scaleLinear().domain([450, 1450]).range([0, 1]);

        var table = d3.select("#table").append("table").classed("sortable", true).attr("id","table_rent");

        var header = table.append("thead").append("tr");

        header.selectAll("th")
              .data(["State", "2015 Rent", "Increase Rate from 2015"])
              .enter()
              .append("th")
              .text(function(d) { return d; });

        var tablebody = table.append("tbody");

        rows = tablebody
                .selectAll("tr")
                .data(myArray)
                .enter()
                .append("tr");

        // We built the rows using the nested array - now each row has its own array.
        cells = rows.selectAll("td")
            // each row has data associated; we get it and enter it for the cells.
                .data(function(d, i) {
                    // console.log(d[1]);
                    return d;
                })
                .enter()
                .append("td")
                .attr("class", function(d,i){
                  return d;
                })
                .style('background-color', function (d, i) {
                    return 'rgba(' + colors[i].r + ',' + colors[i].g + ',' + colors[i].b + ',' + alpha(d) + ')';
                })
                .text(function(d) {
                    return d;
                });

        $('*[class^="+"]').attr("style", "padding-left: 60px");
        // var numData = []

        // var rows = tablebody.selectAll('tr').data(tablebody.data()[0]);
        // for(var i = 0; i <rows.length; i++){
        //   var num = rows[i][1]
        //   numData.push(num);
        // }

        // console.log(numData);

        sorttable.makeSortable(document.getElementById('table_rent'));
    });

</script>
<p style="text-align: left; margin-left: 70%">Source: US Census</p>
<p style="text-align: left; margin-left: 70%">2015 is the latest data avaliable.</p>

</body>
</html>